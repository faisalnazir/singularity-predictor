const Y=(e,t)=>e===t,Z=Symbol("solid-track"),D={equals:Y};let m=null,P=H;const S=1,T=2,Q={owned:null,cleanups:null,context:null,owner:null};var o=null;let j=null,ee=null,c=null,f=null,w=null,V=0;function K(e,t){const s=c,n=o,r=e.length===0,l=t===void 0?n:t,i=r?Q:{owned:null,cleanups:null,context:l?l.context:null,owner:l},a=r?e:()=>e(()=>A(()=>C(i)));o=i,c=null;try{return I(a,!0)}finally{c=s,o=n}}function te(e,t){t=t?Object.assign({},D,t):D;const s={value:e,observers:null,observerSlots:null,comparator:t.equals||void 0},n=r=>(typeof r=="function"&&(r=r(s.value)),z(s,r));return[W.bind(s),n]}function ae(e,t,s){const n=_(e,t,!1,S);O(n)}function ne(e,t,s){P=ue;const n=_(e,t,!1,S);n.user=!0,w?w.push(n):O(n)}function L(e,t,s){s=s?Object.assign({},D,s):D;const n=_(e,t,!0,0);return n.observers=null,n.observerSlots=null,n.comparator=s.equals||void 0,O(n),W.bind(n)}function A(e){if(c===null)return e();const t=c;c=null;try{return e()}finally{c=t}}function he(e){ne(()=>A(e))}function se(e){return o===null||(o.cleanups===null?o.cleanups=[e]:o.cleanups.push(e)),e}function W(){if(this.sources&&this.state)if(this.state===S)O(this);else{const e=f;f=null,I(()=>M(this),!1),f=e}if(c){const e=this.observers?this.observers.length:0;c.sources?(c.sources.push(this),c.sourceSlots.push(e)):(c.sources=[this],c.sourceSlots=[e]),this.observers?(this.observers.push(c),this.observerSlots.push(c.sources.length-1)):(this.observers=[c],this.observerSlots=[c.sources.length-1])}return this.value}function z(e,t,s){let n=e.value;return(!e.comparator||!e.comparator(n,t))&&(e.value=t,e.observers&&e.observers.length&&I(()=>{for(let r=0;r<e.observers.length;r+=1){const l=e.observers[r],i=j&&j.running;i&&j.disposed.has(l),(i?!l.tState:!l.state)&&(l.pure?f.push(l):w.push(l),l.observers&&J(l)),i||(l.state=S)}if(f.length>1e6)throw f=[],new Error},!1)),t}function O(e){if(!e.fn)return;C(e);const t=V;re(e,e.value,t)}function re(e,t,s){let n;const r=o,l=c;c=o=e;try{n=e.fn(t)}catch(i){return e.pure&&(e.state=S,e.owned&&e.owned.forEach(C),e.owned=null),e.updatedAt=s+1,$(i)}finally{c=l,o=r}(!e.updatedAt||e.updatedAt<=s)&&(e.updatedAt!=null&&"observers"in e?z(e,n):e.value=n,e.updatedAt=s)}function _(e,t,s,n=S,r){const l={fn:e,state:n,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:o,context:o?o.context:null,pure:s};return o===null||o!==Q&&(o.owned?o.owned.push(l):o.owned=[l]),l}function F(e){if(e.state===0)return;if(e.state===T)return M(e);if(e.suspense&&A(e.suspense.inFallback))return e.suspense.effects.push(e);const t=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<V);)e.state&&t.push(e);for(let s=t.length-1;s>=0;s--)if(e=t[s],e.state===S)O(e);else if(e.state===T){const n=f;f=null,I(()=>M(e,t[0]),!1),f=n}}function I(e,t){if(f)return e();let s=!1;t||(f=[]),w?s=!0:w=[],V++;try{const n=e();return le(s),n}catch(n){s||(w=null),f=null,$(n)}}function le(e){if(f&&(H(f),f=null),e)return;const t=w;w=null,t.length&&I(()=>P(t),!1)}function H(e){for(let t=0;t<e.length;t++)F(e[t])}function ue(e){let t,s=0;for(t=0;t<e.length;t++){const n=e[t];n.user?e[s++]=n:F(n)}for(t=0;t<s;t++)F(e[t])}function M(e,t){e.state=0;for(let s=0;s<e.sources.length;s+=1){const n=e.sources[s];if(n.sources){const r=n.state;r===S?n!==t&&(!n.updatedAt||n.updatedAt<V)&&F(n):r===T&&M(n,t)}}}function J(e){for(let t=0;t<e.observers.length;t+=1){const s=e.observers[t];s.state||(s.state=T,s.pure?f.push(s):w.push(s),s.observers&&J(s))}}function C(e){let t;if(e.sources)for(;e.sources.length;){const s=e.sources.pop(),n=e.sourceSlots.pop(),r=s.observers;if(r&&r.length){const l=r.pop(),i=s.observerSlots.pop();n<r.length&&(l.sourceSlots[i]=n,r[n]=l,s.observerSlots[n]=i)}}if(e.tOwned){for(t=e.tOwned.length-1;t>=0;t--)C(e.tOwned[t]);delete e.tOwned}if(e.owned){for(t=e.owned.length-1;t>=0;t--)C(e.owned[t]);e.owned=null}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null}e.state=0}function oe(e){return e instanceof Error?e:new Error(typeof e=="string"?e:"Unknown error",{cause:e})}function B(e,t,s){try{for(const n of t)n(e)}catch(n){$(n,s&&s.owner||null)}}function $(e,t=o){const s=m&&t&&t.context&&t.context[m],n=oe(e);if(!s)throw n;w?w.push({fn(){B(n,s,t)},state:S}):B(n,s,t)}function pe(e){m||(m=Symbol("error")),o===null||(o.context===null||!o.context[m]?(o.context={...o.context,[m]:[e]},N(o,m,[e])):o.context[m].push(e))}function N(e,t,s){if(e.owned)for(let n=0;n<e.owned.length;n++)e.owned[n].context===e.context&&N(e.owned[n],t,s),e.owned[n].context?e.owned[n].context[t]||(e.owned[n].context[t]=s,N(e.owned[n],t,s)):(e.owned[n].context=e.context,N(e.owned[n],t,s))}const ie=Symbol("fallback");function G(e){for(let t=0;t<e.length;t++)e[t]()}function ce(e,t,s={}){let n=[],r=[],l=[],i=0,a=t.length>1?[]:null;return se(()=>G(l)),()=>{let g=e()||[],h=g.length,p,u;return g[Z],A(()=>{let v,k,E,R,U,d,b,x,y;if(h===0)i!==0&&(G(l),l=[],n=[],r=[],i=0,a&&(a=[])),s.fallback&&(n=[ie],r[0]=K(X=>(l[0]=X,s.fallback())),i=1);else if(i===0){for(r=new Array(h),u=0;u<h;u++)n[u]=g[u],r[u]=K(q);i=h}else{for(E=new Array(h),R=new Array(h),a&&(U=new Array(h)),d=0,b=Math.min(i,h);d<b&&n[d]===g[d];d++);for(b=i-1,x=h-1;b>=d&&x>=d&&n[b]===g[x];b--,x--)E[x]=r[b],R[x]=l[b],a&&(U[x]=a[b]);for(v=new Map,k=new Array(x+1),u=x;u>=d;u--)y=g[u],p=v.get(y),k[u]=p===void 0?-1:p,v.set(y,u);for(p=d;p<=b;p++)y=n[p],u=v.get(y),u!==void 0&&u!==-1?(E[u]=r[p],R[u]=l[p],a&&(U[u]=a[p]),u=k[u],v.set(y,u)):l[p]();for(u=d;u<h;u++)u in E?(r[u]=E[u],l[u]=R[u],a&&(a[u]=U[u],a[u](u))):r[u]=K(q);r=r.slice(0,i=h),n=g.slice(0)}return r});function q(v){if(l[u]=v,a){const[k,E]=te(u);return a[u]=E,t(g[u],k)}return t(g[u])}}}function we(e,t){return A(()=>e(t||{}))}const fe=e=>`Stale read from <${e}>.`;function de(e){const t="fallback"in e&&{fallback:()=>e.fallback};return L(ce(()=>e.each,e.children,t||void 0))}function be(e){const t=e.keyed,s=L(()=>e.when,void 0,void 0),n=t?s:L(s,void 0,{equals:(r,l)=>!r==!l});return L(()=>{const r=n();if(r){const l=e.children;return typeof l=="function"&&l.length>0?A(()=>l(t?r:()=>{if(!A(n))throw fe("Show");return s()})):l}return e.fallback},void 0,void 0)}export{de as F,be as S,ae as a,L as b,K as c,te as d,we as e,ne as f,se as g,pe as h,he as o,A as u};
